# MIT-BIH ECG 전처리 통합 가이드

## 개요
`mitbih_preprocessor.py`의 전처리 로직이 `utils.py`에 통합되어, `train.py`의 전역변수만 수정하면 자동으로 원하는 설정으로 데이터를 전처리할 수 있습니다.

## 주요 기능

### 1. 자동 전처리 & 캐싱
- 처음 실행 시: Raw MIT-BIH 데이터를 전처리하고 캐시에 저장
- 이후 실행 시: 캐시된 전처리 데이터를 빠르게 로드
- 설정 변경 시: 자동으로 새로운 설정으로 전처리 수행

### 2. 간편한 설정 변경

#### train.py 전역변수 설정
```python
# 데이터 전처리 설정
segment_seconds = 1.0  # ECG 세그먼트 길이 (초)
fs_out = 360           # 출력 샘플링 주파수 (Hz)
ecg_leads = ['MLII']   # 사용할 ECG 리드

# 데이터 경로
path_mitbih_raw = './data/mit-bih-arrhythmia-database-1.0.0'
path_processed_base = './data/processed'
```

## 사용 예시

### 예시 1: 1초 세그먼트 (기본)
```python
segment_seconds = 1.0
fs_out = 360
ecg_leads = ['MLII']
```
→ 출력: `./data/processed/seg1.0_fs360_MLII/`
→ 샘플 수: 360 samples (1.0s × 360Hz)

### 예시 2: 3초 세그먼트
```python
segment_seconds = 3.0
fs_out = 360
ecg_leads = ['MLII']
```
→ 출력: `./data/processed/seg3.0_fs360_MLII/`
→ 샘플 수: 1080 samples (3.0s × 360Hz)

### 예시 3: 5초 세그먼트
```python
segment_seconds = 5.0
fs_out = 360
ecg_leads = ['MLII']
```
→ 출력: `./data/processed/seg5.0_fs360_MLII/`
→ 샘플 수: 1800 samples (5.0s × 360Hz)

### 예시 4: Multi-lead
```python
segment_seconds = 1.0
fs_out = 360
ecg_leads = ['MLII', 'V1']
```
→ 출력: `./data/processed/seg1.0_fs360_MLII_V1/`
→ 2개 리드 동시 사용

## 캐시 디렉토리 구조

```
data/processed/
├── seg1.0_fs360_MLII/          # 1초, 360Hz, MLII
│   ├── train/
│   │   ├── train_data.npy
│   │   └── train_labels.npy
│   ├── test/
│   │   ├── test_data.npy
│   │   └── test_labels.npy
│   └── metadata.json
│
├── seg3.0_fs360_MLII/          # 3초, 360Hz, MLII
│   ├── train/
│   ├── test/
│   └── metadata.json
│
└── seg5.0_fs360_MLII/          # 5초, 360Hz, MLII
    ├── train/
    ├── test/
    └── metadata.json
```

## 전처리 세부 사항

### 적용되는 전처리
1. **밴드패스 필터**: 0.1-100Hz FIR 필터
2. **R-peak 기반 세그먼트 추출**: R-peak 중심으로 전후 균등 분할
3. **리샘플링**: 목표 샘플링 주파수로 보간
4. **정규화**: Z-score 정규화 (평균 0, 표준편차 1)

### 데이터셋 분할
- **DS1 (Train)**: 22개 레코드
- **DS2 (Test)**: 22개 레코드
- **Inter-patient split**: 환자 간 일반화 성능 평가

### 레이블 매핑 (AAMI 표준)
- **N**: Normal beats (N, L, R)
- **S**: Supraventricular ectopic beats (A, a, J, S, e, j)
- **V**: Ventricular ectopic beats (V, E)
- **F**: Fusion beats (F)
- **Q**: Unknown beats (/, f, Q)

## 워크플로우

1. **train.py에서 설정 변경**
```python
segment_seconds = 3.0  # 1초 → 3초로 변경
```

2. **학습 실행**
```bash
python train.py
```





## 요약



```python
# train.py에서 한 줄만 수정
segment_seconds = 3.0 

# 학습 실행
python train.py
```


